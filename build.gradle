defaultTasks 'dev'

// task gitlog(type: Exec) {
//     commandLine '/bin/bash', '-c', 'git log --color --graph --date=format:"%Y-%m-%d %H:%M:%S" --pretty=format:"%Cred%h%Creset %Cgreen(%ad) -%C(yellow)%d%Creset %s %C(bold blue)<%an>%Creset" --abbrev-commit | aha > dashboard/html/pages/commits/commits.html'
// }

task copyCerts(type: Exec) {
    commandLine '/bin/bash', '-c', 'for i in */src/*/resources; do echo cp -v common/src/main/resources/*.pem $i; done'
}


task runQuarkusDev() {
    subprojects.each {
        if ("${it.name}" != "common") {
            dependsOn("${it.name}:quarkusDev")
        }
    }
}

task runQuarkusBuildNative() {
    subprojects.each {
        if ("${it.name}" != "common") {
            dependsOn("${it.name}:build")
        }
    }
}

tasks.register('dev') {
//    dependsOn tasks.gitlog
    dependsOn tasks.runQuarkusDev
    doLast {
        println 'Finished.'
    }
}

tasks.register('build-native') {
    System.setProperty("quarkus.package.type", "native")
    dependsOn tasks.copyCerts
    dependsOn tasks.runQuarkusBuildNative
    doLast {
        println 'Finished.'
    }
}
